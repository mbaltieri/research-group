---
import { getCollection } from 'astro:content';
import PageLayout from '~/layouts/PageLayout.astro';

const ORDERED_GROUPS = [
  'Executive Team',
  'Team Leaders',
  'Researchers',
  'Advisors',
] as const;

const people = await getCollection('people');

// group by category and sort
const grouped = ORDERED_GROUPS
  .map((group) => ({
    label: group,
    people: people
      .filter((p) => p.data.group === group)
      .sort(
        (a, b) =>
          (a.data.order ?? 999) - (b.data.order ?? 999) ||
          a.data.name.localeCompare(b.data.name)
      ),
  }))
  .filter((g) => g.people.length > 0);
---

<PageLayout title="People">
  <section class="mx-auto max-w-7xl px-6 py-16">
    <h1 class="text-4xl font-bold tracking-tight mb-10">People</h1>

    <nav class="mb-10 flex flex-wrap gap-3 text-sm opacity-90">
      {grouped.map((g) => (
        <a href={`#${g.label.toLowerCase()}`} class="rounded-full border px-3 py-1 hover:bg-white/10">
          {g.label}
        </a>
      ))}
    </nav>

    {grouped.map((g, idx) => (
      <section id={g.label.toLowerCase()} class={idx > 0 ? 'pt-12 mt-12 border-t border-white/10' : ''}>
        <h2 class="text-2xl font-semibold tracking-tight mb-6">{g.label}</h2>

        <div class="grid gap-8 sm:grid-cols-2 lg:grid-cols-3">
          {g.people.map(({ data }) => (
            <article class="group rounded-2xl border border-white/10 bg-white/5 p-6 shadow-sm backdrop-blur transition hover:shadow-lg dark:bg-white/5">
              <div class="flex items-center gap-4">
                {data.image ? (
                  <img
                    src={data.image}
                    alt={data.name}
                    width="80"
                    height="80"
                    class="h-20 w-20 rounded-xl object-cover"
                    loading="lazy"
                  />
                ) : (
                  <div class="h-20 w-20 rounded-xl bg-white/10" />
                )}
                <div>
                  <h3 class="text-xl font-semibold">{data.name}</h3>
                  {data.role && <p class="text-sm opacity-80">{data.role}</p>}
                </div>
              </div>

              {data.bio && (
                <p class="mt-4 text-sm leading-6 opacity-90">{data.bio}</p>
              )}

              <div class="mt-5 flex flex-wrap items-center gap-3 text-sm opacity-90">
                {data.website && (
                  <a href={data.website} class="underline hover:no-underline">Website</a>
                )}
                {data.github && (
                  <a href={`https://github.com/${data.github}`} class="underline hover:no-underline">GitHub</a>
                )}
                {data.twitter && (
                  <a href={`https://twitter.com/${data.twitter}`} class="underline hover:no-underline">Twitter/X</a>
                )}
                {data.email && (
                  <a href={`mailto:${data.email}`} class="underline hover:no-underline">Email</a>
                )}
              </div>
            </article>
          ))}
        </div>
      </section>
    ))}
  </section>
</PageLayout>

